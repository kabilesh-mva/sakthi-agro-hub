import{j as e}from"./query-ClOPU3jo.js";import{r as a}from"./router-BUgJjUvb.js";import{B as b,C as U,c as B,d as q,a as z,b as ye,e as Ne}from"./card-bs4xkOJH.js";import{I}from"./input-NrPULnar.js";import{i as we,L as W,j as X,k as H,l as be,m as Se,n as Y,o as Pe,p as Ce,q as Z,r as Ee,s as K,u as ke,v as Ie,w as Q,x as ee,y as se,z as te,B as ae,E as Ae}from"./ui-Br0k5SbM.js";import{c as g,a as G}from"./index-D2td1B68.js";import{s as w}from"./client-CtY_iIHf.js";import{T as J}from"./textarea-BHFsIfcq.js";import{L as N}from"./label-BoOH8tbl.js";import{S as De}from"./switch-DbK2qnmK.js";import{w as re,y as Fe,z as _e,h as P,B as Re,X as Te,E as Le,I as ie,f as Me,J as Ue,K as Be}from"./utils-CUBaLrxp.js";import{D as qe,a as ze,b as Ge,c as $e,d as Oe}from"./dialog-D4yHyK5F.js";import"./vendor-BVORfsS8.js";import"./supabase-DquKuMF8.js";const Ve=we,le=a.forwardRef(({className:t,...i},r)=>e.jsx(W,{ref:r,className:g("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...i}));le.displayName=W.displayName;const L=a.forwardRef(({className:t,...i},r)=>e.jsx(X,{ref:r,className:g("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...i}));L.displayName=X.displayName;const M=a.forwardRef(({className:t,...i},r)=>e.jsx(H,{ref:r,className:g("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...i}));M.displayName=H.displayName;const Je=be,We=Se,ne=a.forwardRef(({className:t,children:i,...r},o)=>e.jsxs(Y,{ref:o,className:g("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[i,e.jsx(Pe,{asChild:!0,children:e.jsx(re,{className:"h-4 w-4 opacity-50"})})]}));ne.displayName=Y.displayName;const ce=a.forwardRef(({className:t,...i},r)=>e.jsx(Q,{ref:r,className:g("flex cursor-default items-center justify-center py-1",t),...i,children:e.jsx(_e,{className:"h-4 w-4"})}));ce.displayName=Q.displayName;const oe=a.forwardRef(({className:t,...i},r)=>e.jsx(ee,{ref:r,className:g("flex cursor-default items-center justify-center py-1",t),...i,children:e.jsx(re,{className:"h-4 w-4"})}));oe.displayName=ee.displayName;const de=a.forwardRef(({className:t,children:i,position:r="popper",...o},f)=>e.jsx(Ce,{children:e.jsxs(Z,{ref:f,className:g("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...o,children:[e.jsx(ce,{}),e.jsx(Ee,{className:g("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(oe,{})]})}));de.displayName=Z.displayName;const Xe=a.forwardRef(({className:t,...i},r)=>e.jsx(se,{ref:r,className:g("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...i}));Xe.displayName=se.displayName;const me=a.forwardRef(({className:t,children:i,...r},o)=>e.jsxs(K,{ref:o,className:g("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ke,{children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(Ie,{children:i})]}));me.displayName=K.displayName;const He=a.forwardRef(({className:t,...i},r)=>e.jsx(te,{ref:r,className:g("-mx-1 my-1 h-px bg-muted",t),...i}));He.displayName=te.displayName;const ue=a.forwardRef(({className:t,value:i,...r},o)=>e.jsx(ae,{ref:o,className:g("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:e.jsx(Ae,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(i||0)}%)`}})}));ue.displayName=ae.displayName;const Ye=["Sprayers","Pumps & Irrigation","Engines","Spare Parts & Accessories","Power Tools","Others"],Ze=["image/jpeg","image/jpg","image/png","image/webp","image/gif"],Ke=5*1024*1024,Qe=()=>{const[t,i]=a.useState([]),[r,o]=a.useState(!0),[f,y]=a.useState(!1),[x,p]=a.useState(null),[c,h]=a.useState({name:"",category:"",description:"",specifications:"",price:"",in_stock:!0,image_url:""}),[l,u]=a.useState(!1),[m,$]=a.useState(!1),[A,D]=a.useState(0),[O,F]=a.useState(null),[V,E]=a.useState(null),C=a.useRef(null),{toast:j}=G(),k=a.useCallback(async()=>{try{o(!0);const{data:s,error:n}=await w.from("products").select("*").order("created_at",{ascending:!1});if(n)throw n;i(s||[])}catch(s){const n=s instanceof Error?s.message:"Failed to load products";j({title:"Error",description:n,variant:"destructive"})}finally{o(!1)}},[j]);a.useEffect(()=>{k()},[k]);const ge=s=>{const n=s.target.files?.[0];if(!n)return;if(!Ze.includes(n.type)){j({title:"Invalid file type",description:"Please select a JPG, JPEG, PNG, WebP, or GIF image",variant:"destructive"});return}if(n.size>Ke){j({title:"File too large",description:"Image must be less than 5MB",variant:"destructive"});return}F(n);const d=new FileReader;d.onloadend=()=>{E(d.result)},d.readAsDataURL(n)},xe=async(s,n)=>{if(!s)return null;try{$(!0),D(0);const d=s.name.split(".").pop(),v=`${`${n.replace(/[^a-zA-Z0-9]/g,"-")}-${Date.now()}.${d}`}`,{data:S,error:T}=await w.storage.from("product-images").upload(v,s,{cacheControl:"3600",upsert:!1});if(T)throw T.message.includes("bucket")&&j({title:"Storage bucket not found",description:"Please create a 'product-images' bucket in Supabase Storage",variant:"destructive"}),T;const{data:ve}=w.storage.from("product-images").getPublicUrl(v);return D(100),ve.publicUrl}catch(d){throw new Error(`Failed to upload image: ${d.message}`)}finally{$(!1),D(0)}},fe=async s=>{s.preventDefault(),u(!0);try{if(!c.name.trim())throw new Error("Product name is required");if(!c.category)throw new Error("Category is required");let n=null;if(c.price&&c.price.trim()!==""){const v=parseFloat(c.price);if(isNaN(v))throw new Error("Invalid price value. Please enter a valid number.");n=v}let d=c.image_url;if(O){const v=await xe(O,c.name);v&&(d=v)}const R={name:c.name.trim(),category:c.category,description:c.description.trim()||null,specifications:c.specifications.trim()||null,price:n,in_stock:c.in_stock,image_url:d||null};if(x){const{data:v,error:S}=await w.from("products").update(R).eq("id",x.id).select();if(S)throw S;j({title:"Success",description:"Product updated successfully"})}else{const{data:v,error:S}=await w.from("products").insert(R).select();if(S)throw S;j({title:"Success",description:"Product added successfully"})}y(!1),_(),k()}catch(n){let d="Failed to save product. ";n?.message?d+=n.message:typeof n=="string"&&(d+=n),j({title:"Error saving product",description:d,variant:"destructive"})}finally{u(!1)}},pe=s=>{p(s),h({name:s.name,category:s.category,description:s.description||"",specifications:s.specifications||"",price:s.price?.toString()||"",in_stock:s.in_stock,image_url:s.image_url||""}),s.image_url&&E(s.image_url),y(!0)},he=async s=>{if(confirm("Are you sure you want to delete this product?"))try{const{error:n}=await w.from("products").delete().eq("id",s);if(n)throw n;j({title:"Success",description:"Product deleted successfully"}),k()}catch(n){const d=n instanceof Error?n.message:"An error occurred";j({title:"Error",description:d,variant:"destructive"})}},_=()=>{h({name:"",category:"",description:"",specifications:"",price:"",in_stock:!0,image_url:""}),p(null),F(null),E(null),C.current&&(C.current.value="")},je=()=>{F(null),E(null),C.current&&(C.current.value="")};return r?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(P,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Product Management"}),e.jsxs(qe,{open:f,onOpenChange:s=>{y(s),s||_()},children:[e.jsx(ze,{asChild:!0,children:e.jsxs(b,{children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Add Product"]})}),e.jsxs(Ge,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx($e,{children:e.jsx(Oe,{children:x?"Edit Product":"Add New Product"})}),e.jsxs("form",{onSubmit:fe,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Product Name *"}),e.jsx(I,{id:"name",value:c.name,onChange:s=>h({...c,name:s.target.value}),required:!0,disabled:l||m})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"category",children:"Category *"}),e.jsxs(Je,{value:c.category,onValueChange:s=>h({...c,category:s}),required:!0,disabled:l||m,children:[e.jsx(ne,{children:e.jsx(We,{placeholder:"Select category"})}),e.jsx(de,{children:Ye.map(s=>e.jsx(me,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Description"}),e.jsx(J,{id:"description",value:c.description,onChange:s=>h({...c,description:s.target.value}),rows:3,disabled:l||m})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"specifications",children:"Specifications"}),e.jsx(J,{id:"specifications",value:c.specifications,onChange:s=>h({...c,specifications:s.target.value}),rows:2,disabled:l||m})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"price",children:"Price (₹)"}),e.jsx(I,{id:"price",type:"number",step:"0.01",value:c.price,onChange:s=>h({...c,price:s.target.value}),disabled:l||m})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"image",children:"Product Image"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:ge,disabled:l||m,ref:C}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Supported: JPG, JPEG, PNG, WebP, GIF (Max 5MB)"})]})]})]}),V&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-border bg-muted max-w-xs",children:[e.jsx("img",{src:V,alt:"Product preview",className:"w-full h-48 object-cover"}),!l&&!m&&e.jsx("button",{type:"button",onClick:je,className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(Te,{className:"h-4 w-4"})}),m&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(P,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Uploading..."})]})})]}),m&&A>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(ue,{value:A,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Uploading image... ",A,"%"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{id:"in_stock",checked:c.in_stock,onCheckedChange:s=>h({...c,in_stock:s}),disabled:l||m}),e.jsx(N,{htmlFor:"in_stock",children:"In Stock"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(b,{type:"submit",className:"flex-1",disabled:l||m,children:l?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),x?"Updating...":"Adding..."]}):m?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading Image..."]}):e.jsx(e.Fragment,{children:x?"Update Product":"Add Product"})}),e.jsx(b,{type:"button",variant:"outline",onClick:()=>{y(!1),_()},disabled:l||m,children:"Cancel"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(s=>e.jsxs(U,{children:[e.jsxs(B,{children:[s.image_url&&e.jsx("div",{className:"mb-3 rounded-lg overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-48 object-cover",onError:n=>{n.target.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Crect fill='%23e2e8f0' width='200' height='200'/%3E%3Ctext fill='%2394a3b8' x='50%25' y='50%25' text-anchor='middle' dy='.3em'%3ENo Image%3C/text%3E%3C/svg%3E"}})}),e.jsx(q,{className:"text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.category})]}),e.jsxs(z,{children:[s.description&&e.jsx("p",{className:"text-sm mb-2",children:s.description}),s.price&&e.jsxs("p",{className:"text-lg font-bold text-primary",children:["₹",s.price]}),e.jsxs("p",{className:"text-sm mt-2",children:["Status:"," ",e.jsx("span",{className:s.in_stock?"text-green-600":"text-red-600",children:s.in_stock?"In Stock":"Out of Stock"})]})]}),e.jsxs(ye,{className:"flex gap-2",children:[e.jsxs(b,{size:"sm",variant:"outline",onClick:()=>pe(s),className:"flex-1",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(b,{size:"sm",variant:"destructive",onClick:()=>he(s.id),className:"flex-1",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]},s.id))}),t.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:'No products yet. Click "Add Product" to create your first product.'})]})},es=()=>{const[t,i]=a.useState([]),[r,o]=a.useState(!0),[f,y]=a.useState(null),{toast:x}=G(),p=async()=>{try{o(!0);const{data:l,error:u}=await w.from("reviews").select("*").order("created_at",{ascending:!1});if(u)throw u;i(l||[])}catch{x({title:"Error",description:"Failed to load reviews",variant:"destructive"})}finally{o(!1)}};a.useEffect(()=>{p()},[]);const c=async l=>{if(confirm("Are you sure you want to delete this review?"))try{y(l);const{error:u}=await w.from("reviews").delete().eq("id",l);if(u)throw u;x({title:"Success",description:"Review deleted successfully"}),p()}catch{x({title:"Error",description:"Failed to delete review",variant:"destructive"})}finally{y(null)}},h=l=>e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(u=>e.jsx(Me,{className:`w-4 h-4 ${u<=l?"fill-[#F9A300] text-[#F9A300]":"fill-gray-300 text-gray-300"}`},u))});return r?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(P,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Review Management"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.length," review",t.length!==1?"s":""," total"]})]}),t.length===0?e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:e.jsx("p",{className:"text-gray-500",children:"No reviews yet"})}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:t.map(l=>e.jsxs(U,{children:[e.jsx(B,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#2E7D32] to-[#1B5E20] flex items-center justify-center text-white font-bold text-lg",children:l.name.charAt(0)}),e.jsxs("div",{children:[e.jsx(q,{className:"text-lg",children:l.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(l.created_at).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),h(l.rating)]})}),e.jsxs(z,{children:[e.jsx("p",{className:"text-gray-700 mb-4",children:l.comment}),e.jsx(b,{variant:"destructive",size:"sm",onClick:()=>c(l.id),disabled:f===l.id,children:f===l.id?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Delete Review"]})})]})]},l.id))})]})},ss="sakthiagro",ps=()=>{const[t,i]=a.useState(!1),[r,o]=a.useState(""),{toast:f}=G();a.useEffect(()=>{localStorage.getItem("adminAuthenticated")==="true"&&i(!0)},[]);const y=p=>{p.preventDefault(),r===ss?(i(!0),localStorage.setItem("adminAuthenticated","true"),f({title:"Success",description:"Welcome to Admin Panel!"}),o("")):(f({title:"Access Denied",description:"Invalid admin code. Please try again.",variant:"destructive"}),o(""))},x=()=>{i(!1),localStorage.removeItem("adminAuthenticated"),f({title:"Logged Out",description:"You have been logged out successfully."}),window.location.href="/"};return t?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Panel"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sakthi Agro Management"})]}),e.jsxs(b,{variant:"outline",onClick:x,children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Logout"]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(Ve,{defaultValue:"products",className:"w-full",children:[e.jsxs(le,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsx(L,{value:"products",children:"Products"}),e.jsx(L,{value:"reviews",children:"Reviews"})]}),e.jsx(M,{value:"products",className:"mt-6",children:e.jsx(Qe,{})}),e.jsx(M,{value:"reviews",className:"mt-6",children:e.jsx(es,{})})]})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center p-4",children:e.jsxs(U,{className:"w-full max-w-md",children:[e.jsxs(B,{className:"space-y-1",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ue,{className:"h-6 w-6 text-primary"})})}),e.jsx(q,{className:"text-2xl text-center",children:"Admin Access"}),e.jsx(Ne,{className:"text-center",children:"Enter your admin code to access the management panel"})]}),e.jsx(z,{children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"code",children:"Admin Code"}),e.jsx(I,{id:"code",type:"password",placeholder:"Enter admin code",value:r,onChange:p=>o(p.target.value),required:!0,autoFocus:!0})]}),e.jsx(b,{type:"submit",className:"w-full",children:"Access Admin Panel"})]})})]})})};export{ps as default};
